{%- comment -%}
Simple collection card used by `collection-list` (MAG)
- card_collection: Collection object (required)
- media_aspect_ratio: 'adapt' | 'square' | 'portrait'
- columns: Number of columns (for sizes calc)
- placeholder_image: key like 'collection-apparel-1' (optional)
{%- endcomment -%}

{%- liquid
  assign ratio = 1
  if card_collection and card_collection.featured_image
    if media_aspect_ratio == 'portrait'
      assign ratio = 0.8
    elsif media_aspect_ratio == 'adapt'
      assign ratio = card_collection.featured_image.aspect_ratio
    endif
  endif
  if ratio == 0 or ratio == null
    assign ratio = 1
  endif
  assign title = card_collection.title | default: 'Collection'
  assign href  = card_collection.url  | default: routes.collections_url
-%}

<article class="collection-mag">
  <a href="{{ href }}" class="collection-mag__media-link">
    <div class="collection-mag__media ratio" style="--ratio-percent: {{ 1 | divided_by: ratio | times: 100 }}%;">
      {%- if card_collection and card_collection.featured_image -%}
        <img
                srcset="
            {%- if card_collection.featured_image.width >= 330  -%}{{ card_collection.featured_image | image_url: width: 330  }} 330w,{%- endif -%}
            {%- if card_collection.featured_image.width >= 535  -%}{{ card_collection.featured_image | image_url: width: 535  }} 535w,{%- endif -%}
            {%- if card_collection.featured_image.width >= 750  -%}{{ card_collection.featured_image | image_url: width: 750  }} 750w,{%- endif -%}
            {%- if card_collection.featured_image.width >= 1000 -%}{{ card_collection.featured_image | image_url: width: 1000 }} 1000w,{%- endif -%}
            {%- if card_collection.featured_image.width >= 1500 -%}{{ card_collection.featured_image | image_url: width: 1500 }} 1500w,{%- endif -%}
            {{ card_collection.featured_image | image_url }} {{ card_collection.featured_image.width }}w
          "
                sizes="
            (min-width: {{ settings.page_width }}px) {{ settings.page_width | minus: 100 | divided_by: columns }}px,
            (min-width: 750px) {% if columns > 1 %}calc((100vw - 10rem) / 2){% else %}calc(100vw - 10rem){% endif %},
            calc(100vw - 3rem)
          "
                src="{{ card_collection.featured_image | image_url: width: 1000 }}"
                width="{{ card_collection.featured_image.width }}"
                height="{{ card_collection.featured_image.height }}"
                alt="{{ card_collection.featured_image.alt | escape }}"
                class="collection-mag__img motion-reduce"
                loading="lazy"
        >
      {%- else -%}
        {{ placeholder_image | default: 'collection-apparel-1' | placeholder_svg_tag: 'placeholder-svg' }}
      {%- endif -%}
    </div>
  </a>

  <p class="collection-mag__title">
    <a href="{{ href }}" class="collection-mag__link">
      {{- title | escape -}}
      {%- comment -%}<span class="collection-mag__arrow" aria-hidden="true">â†’</span>{%- endcomment -%}
    </a>
  </p>
</article>
