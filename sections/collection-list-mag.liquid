{{ 'collection-list-mag.css' | asset_url | stylesheet_tag }}
{{ 'component-card.css'       | asset_url | stylesheet_tag }}
{{ 'component-slider.css'     | asset_url | stylesheet_tag }}
{{ 'custom-buttons.css'       | asset_url | stylesheet_tag }}

{%- style -%}
    .section-{{ section.id }}-padding{padding-top:{{ section.settings.padding_top | times: 0.75 | round: 0 }}px;padding-bottom:{{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px}
    @media (min-width:750px){.section-{{ section.id }}-padding{padding-top:{{ section.settings.padding_top }}px;padding-bottom:{{ section.settings.padding_bottom }}px}}
{%- endstyle -%}

{%- liquid
    assign blocks_count         = section.blocks.size
    assign columns_desktop_int  = section.settings.columns_desktop | plus: 0
    assign columns_mobile_int   = section.settings.columns_mobile  | plus: 0

    assign show_mobile_slider   = false
    if section.settings.swipe_on_mobile and blocks_count > columns_mobile_int
        assign show_mobile_slider = true
    endif

    assign show_desktop_slider  = false
    if section.settings.enable_desktop_slider and blocks_count > columns_desktop_int
        assign show_desktop_slider = true
    endif
-%}

<section class="section-{{ section.id }}-padding">
    <div class="{% if section.settings.full_bleed %}collection-list-mag__fullbleed{% else %}page-width{% endif %}">
        {% unless section.settings.title == blank %}
            <div class="collection-mag__header{% if show_mobile_slider %} title-wrapper--self-padded-tablet-down{% else %} title-wrapper--self-padded-mobile{% endif %}{% if show_desktop_slider %} collection-mag__header--desktop-slider{% endif %}{% if section.settings.full_bleed %} page-width{% endif %}">
                <h2 id="SectionHeading-{{ section.id }}"
                    class="collection-list-title inline-richtext {{ section.settings.heading_size }}">
                    {{ section.settings.title }}
                </h2>

                {% if section.settings.show_view_all %}
                    {% assign button_label = section.settings.view_all_text | default: 'VIEW ALL' %}
                    {% render 'button',
                            label: button_label,
                            classes: 'mb-14',
                            type: 'link',
                            icon: 'arrow',
                            href: routes.collections_url %}
                {% endif %}
            </div>
        {% endunless %}

        {%- comment -%} Slider wrapper only if needed {%- endcomment -%}
        <slider-component
                class="slider-mobile-gutter{% if section.settings.full_bleed %} slider-component-full-width{% endif %}{% if show_desktop_slider %} slider-component-desktop{% endif %}{% if show_mobile_slider %} scroll-trigger animate--slide-in{% endif %}"
                {% unless show_mobile_slider or show_desktop_slider %}hidden{% endunless %}>
            <ul id="Slider-{{ section.id }}"
                class="collection-list contains-card contains-card--collection
                 dawn-grid grid--{{ section.settings.columns_desktop }}-col-desktop
                 grid--{{ section.settings.columns_mobile }}-col-tablet-down
                 {% if show_desktop_slider %} slider slider--desktop{% endif %}
                 {% if show_mobile_slider %} slider slider--tablet grid--peek{% endif %}"
                role="list">
                {%- liquid
                    assign columns = blocks_count
                    if columns > columns_desktop_int
                        assign columns = columns_desktop_int
                    endif
                -%}
                {% for block in section.blocks %}
                    {% assign placeholder_image_index = forloop.index0 | modulo: 4 | plus: 1 %}
                    {% assign placeholder_image = 'collection-apparel-' | append: placeholder_image_index %}
                    <li id="Slide-{{ section.id }}-{{ forloop.index }}"
                        class="grid__item{% if show_mobile_slider or show_desktop_slider %} slider__slide{% endif %}"
                            {{ block.shopify_attributes }}>
                        {% render 'card-collection-mag',
                                card_collection: block.settings.collection,
                                media_aspect_ratio: section.settings.image_ratio,
                                columns: columns,
                                placeholder_image: placeholder_image %}
                    </li>
                {% endfor %}
            </ul>

            {%- if show_mobile_slider or show_desktop_slider -%}
                <div class="slider-buttons">
                    <button type="button" class="slider-button slider-button--prev"
                            name="previous" aria-label="{{ 'general.slider.previous_slide' | t }}"
                            aria-controls="Slider-{{ section.id }}">
                        <span class="svg-wrapper">{{ 'icon-caret.svg' | inline_asset_content }}</span>
                    </button>
                    <div class="slider-counter caption">
                        <span class="slider-counter--current">1</span>
                        <span aria-hidden="true"> / </span>
                        <span class="visually-hidden">{{ 'general.slider.of' | t }}</span>
                        <span class="slider-counter--total">{{ blocks_count }}</span>
                    </div>
                    <button type="button" class="slider-button slider-button--next"
                            name="next" aria-label="{{ 'general.slider.next_slide' | t }}"
                            aria-controls="Slider-{{ section.id }}">
                        <span class="svg-wrapper">{{ 'icon-caret.svg' | inline_asset_content }}</span>
                    </button>
                </div>
            {%- endif -%}
        </slider-component>

        {%- comment -%} Non-slider fallback (when not needed/enabled) {%- endcomment -%}
        {% unless show_mobile_slider or show_desktop_slider %}
            <ul class="dawn-grid product-grid contains-card contains-card--collection
                 grid--{{ section.settings.columns_desktop }}-col-desktop
                 grid--{{ section.settings.columns_mobile }}-col-tablet-down"
                role="list">
                {%- liquid
                    assign columns = blocks_count
                    if columns > columns_desktop_int
                        assign columns = columns_desktop_int
                    endif
                -%}
                {% for block in section.blocks %}
                    {% assign placeholder_image_index = forloop.index0 | modulo: 4 | plus: 1 %}
                    {% assign placeholder_image = 'collection-apparel-' | append: placeholder_image_index %}
                    <li class="grid__item" {{ block.shopify_attributes }}>
                        {% render 'card-collection-mag',
                                card_collection: block.settings.collection,
                                media_aspect_ratio: section.settings.image_ratio,
                                columns: columns,
                                placeholder_image: placeholder_image %}
                    </li>
                {% endfor %}
            </ul>
        {% endunless %}
    </div>
</section>

{% schema %}
{
  "name": "Collection list – MAG",
  "tag": "section",
  "class": "section section-collection-list",
  "max_blocks": 15,
  "disabled_on": { "groups": ["header", "footer"] },
  "settings": [
    { "type": "inline_richtext", "id": "title", "default": "Our Collections", "label": "Title" },
    { "type": "select", "id": "heading_size",
      "options": [ { "value": "h2", "label": "H2" }, { "value": "h1", "label": "H1" }, { "value": "h0", "label": "H0" } ],
      "default": "h1", "label": "Heading size" },

    { "type": "header", "content": "Layout" },
    { "type": "select", "id": "image_ratio",
      "options": [
        { "value": "adapt", "label": "Adapt to image" },
        { "value": "portrait", "label": "Portrait" },
        { "value": "square", "label": "Square" }
      ],
      "default": "adapt", "label": "Image ratio" },
    { "type": "range", "id": "columns_desktop", "min": 1, "max": 6, "step": 1, "default": 3, "label": "Columns (desktop)" },
    { "type": "select", "id": "columns_mobile",
      "options": [ { "value": "1", "label": "1" }, { "value": "2", "label": "2" } ],
      "default": "1", "label": "Columns (mobile)" },
    { "type": "checkbox", "id": "full_bleed", "default": true, "label": "Full-bleed width" },

    { "type": "header", "content": "Slider" },
    { "type": "checkbox", "id": "enable_desktop_slider", "default": true,  "label": "Enable slider on desktop (auto when overflow)" },
    { "type": "checkbox", "id": "swipe_on_mobile",       "default": true,  "label": "Enable swipe on mobile (auto when overflow)" },

    { "type": "header", "content": "View all" },
    { "type": "checkbox", "id": "show_view_all", "default": true, "label": "Show “View all”" },
    { "type": "text",     "id": "view_all_text", "default": "VIEW ALL", "label": "View-all text" },

    { "type": "header", "content": "Padding" },
    { "type": "range", "id": "padding_top", "min": 0, "max": 100, "step": 4, "unit": "px", "default": 40, "label": "Top padding" },
    { "type": "range", "id": "padding_bottom", "min": 0, "max": 100, "step": 4, "unit": "px", "default": 40, "label": "Bottom padding" }
  ],
  "blocks": [
    { "type": "featured_collection", "name": "Collection",
      "settings": [ { "type": "collection", "id": "collection", "label": "Collection" } ] }
  ],
  "presets": [
    { "name": "Collection list – MAG",
      "blocks": [ { "type": "featured_collection" }, { "type": "featured_collection" }, { "type": "featured_collection" } ] }
  ]
}
{% endschema %}
